<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MAERSK ‚Äî Login</title>
<style>
:root{
  --brand:#0b74c7; --bg:#0b1120; --ink:#f9fafb; --muted:#9ca3af;
  --card:#111827; --line:#1f2937; --radius:12px; --ok:#10b981; --err:#ef4444;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font:14px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial;
  display:grid;place-items:center;padding:20px
}
.card{
  width:100%;max-width:460px;background:var(--card);border:1px solid var(--line);
  border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px
}
header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.logo{
  width:42px;height:42px;border-radius:10px;background:#0f172a;
  border:1px solid var(--line);display:grid;place-items:center;
}
.logo:before{
  content:"‚õµ";font-size:20px;color:#8ec7ff;
}
h1{font-size:18px;margin:0}
.small{color:var(--muted);font-size:12px}

.form{display:grid;gap:12px;margin-top:10px}
.field{display:grid;gap:6px}
label{font-weight:600}
input,select{
  border:1px solid #243041;border-radius:10px;padding:10px 12px;font:inherit;
  background:#0f172a;color:var(--ink);
}
input::placeholder{color:#6b7280}
input:focus,select:focus{outline:none;border-color:#446089;box-shadow:0 0 0 3px rgba(11,116,199,.25)}
.row{display:grid;grid-template-columns:1fr 150px;gap:10px}
@media (max-width:520px){ .row{grid-template-columns:1fr} }

.checkbox{display:flex;align-items:center;gap:8px;color:#cbd5e1}
.btn{
  border:1px solid var(--line);background:var(--brand);border-radius:10px;
  padding:10px 14px;cursor:pointer;color:#fff;font-weight:700
}
.btn:disabled{opacity:.7;cursor:not-allowed}
.actions{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-top:4px}

.alert{margin-top:8px;padding:8px 10px;border-radius:10px;border:1px solid #334155;display:none}
.alert.ok{background:#052e1b;border-color:#14532d;color:#a7f3d0;display:block}
.alert.err{background:#2a0b0b;border-color:#7f1d1d;color:#fecaca;display:block}
.footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;color:#94a3b8}
.link{color:#8ec7ff;text-decoration:none}
.link:hover{text-decoration:underline}

/* toggle de password */
.pwd-wrap{position:relative}
.pwd-wrap .eye{
  position:absolute;right:8px;top:50%;transform:translateY(-50%);
  font-size:12px;color:#9ca3af;cursor:pointer;user-select:none;
}
.pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid var(--line);
  border-radius:999px;background:#0f172a;font-size:12px;color:#9ca3af;}
</style>
</head>
<body>

<div class="card">
  <header>
    <div class="logo"></div>
    <div>
      <h1>Ingreso MAERSK</h1>
      <div class="small">Control de inspecciones ¬∑ Reefer</div>
    </div>
  </header>

  <form id="frm" class="form" novalidate>
    <div class="field">
      <label for="user">Usuario</label>
      <input id="user" placeholder="Nombre y apellido" autocomplete="username" required/>
    </div>

    <div class="row">
      <div class="field">
        <label for="role">Rol</label>
        <select id="role" required>
          <option value="">‚Äî Selecciona ‚Äî</option>
          <option value="admin">ADMIN</option>
          <option value="inspector">INSPECTOR</option>
        </select>
      </div>
      <div class="field pwd-wrap">
        <label for="pwd">Clave (opcional)</label>
        <input id="pwd" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
        <span id="togglePwd" class="eye" title="Mostrar/ocultar">üëÅ</span>
      </div>
    </div>

    <div class="checkbox">
      <input id="remember" type="checkbox" checked>
      <label for="remember">Recordarme en este equipo</label>
    </div>

    <div class="actions">
      <button id="btnLogin" type="submit" class="btn">Entrar</button>
      <span id="status" class="pill">‚Äî</span>
    </div>

    <div id="msg" class="alert"></div>
  </form>

  <div class="footer small">
    <span>¬© Maersk Line Chile Spa</span>
    <a class="link" href="#" id="help">¬øNecesitas ayuda?</a>
  </div>
</div>

<script>
/* Redirigir si ya hay sesi√≥n */
(function(){
  try{
    const u = localStorage.getItem('auth_user');
    const r = localStorage.getItem('auth_role');
    if(u && r){ location.replace('home.html'); }
  }catch(_){}
})();

const $ = s => document.querySelector(s);
const msg = $("#msg");
const btn = $("#btnLogin");
const statusEl = $("#status");
const frm = $("#frm");

function showMsg(text, ok=false){
  msg.textContent = text;
  msg.className = "alert " + (ok ? "ok" : "err");
  msg.style.display = "block";
  setTimeout(()=>{ msg.style.display="none"; }, 3000);
}
function onlineStatus(){
  statusEl.textContent = navigator.onLine ? "En l√≠nea" : "Sin conexi√≥n (modo local)";
}
window.addEventListener('online', onlineStatus);
window.addEventListener('offline', onlineStatus);
onlineStatus();

/* Mostrar/ocultar password */
$("#togglePwd").onclick = ()=>{
  const i = $("#pwd");
  i.type = i.type === "password" ? "text" : "password";
};

/* Validaci√≥n + persistencia */
frm.addEventListener("submit", (e)=>{
  e.preventDefault();
  const user = $("#user").value.trim();
  const role = $("#role").value.trim().toLowerCase();

  if(!user){ showMsg("Ingresa tu nombre de usuario"); $("#user").focus(); return; }
  if(!role){ showMsg("Selecciona un rol"); $("#role").focus(); return; }

  try{
    localStorage.setItem("auth_user", JSON.stringify(user));
    localStorage.setItem("auth_role", role);
    if(!$("#remember").checked){
      // Sesi√≥n vol√°til ‚Äî se limpia al cerrar pesta√±a
      window.addEventListener('beforeunload', ()=> {
        localStorage.removeItem("auth_user");
        localStorage.removeItem("auth_role");
      }, { once:true });
    }
    showMsg("Bienvenido, " + user, true);
    btn.disabled = true;
    setTimeout(()=> location.replace('home.html'), 350);
  }catch(err){
    console.error(err);
    showMsg("No se pudo guardar la sesi√≥n (revisa permisos del navegador)");
  }
});

/* Ayuda */
$("#help").addEventListener("click", (e)=>{
  e.preventDefault();
  showMsg("Si olvidaste tu clave, contacta a Sistemas o usa el modo sin clave.", true);
});
$("#user").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ $("#role").focus(); }});
$("#role").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ btn.click(); }});
</script>
</body>
</html>
