<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MAERSK — Inicio</title>
<meta http-equiv="Cache-Control" content="no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<style>
:root{
  --brand:#0b74c7; --bg:#f6f8fb; --ink:#0f172a; --muted:#6b7280;
  --card:#fff; --line:#e5e7eb;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font:14px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial;
  display:grid;place-items:center;padding:20px;
}
.box{
  width:100%;max-width:460px;background:var(--card);border:1px solid var(--line);
  border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.06);padding:16px;text-align:center
}
.logo{width:48px;height:48px;margin:6px auto 12px;border-radius:12px;background:var(--brand);
  box-shadow:0 0 0 2px var(--brand) inset,0 10px 30px rgba(11,116,199,.25)}
h1{font-size:18px;margin:0 0 6px}
.small{color:var(--muted);font-size:12px}
.bar{margin:14px auto 10px;height:6px;width:120px;border-radius:999px;background:#e6eefb;overflow:hidden;position:relative}
.bar::after{content:"";position:absolute;left:-40%;top:0;height:100%;width:40%;border-radius:999px;background:linear-gradient(90deg,#9cc6ff,#0b74c7);
animation:run 1.1s infinite ease-in-out}
@keyframes run{0%{left:-40%}50%{left:60%}100%{left:-40%}}
.btn{display:inline-block;margin-top:10px;padding:10px 14px;border-radius:10px;
  background:#0b74c7;color:#fff;text-decoration:none;border:1px solid #0b74c7}
.alt{display:block;margin-top:8px}
.meta{margin-top:10px;color:#6b7280;font-size:12px}
kbd{font-family:ui-monospace,Consolas,monospace;background:#f3f4f6;border:1px solid #e5e7eb;padding:2px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="box">
  <div class="logo"></div>
  <h1>MAERSK — Reefer</h1>
  <div class="small" id="status">Verificando sesión…</div>
  <div class="bar"></div>

  <a class="btn" id="btnGo" href="login.html" style="display:none">Ir ahora</a>
  <div class="alt">
    <a class="small" href="#" id="hardReload">Forzar recarga (Ctrl+F5)</a>
  </div>
  <div class="meta">
    <span id="net">—</span> · <span id="ver">Index Router</span>
  </div>
</div>

<script>
(function(){
  const qs = location.search || "";
  const net = document.getElementById("net");
  const status = document.getElementById("status");
  const btnGo = document.getElementById("btnGo");

  function setNet(){
    net.textContent = navigator.onLine ? "En línea" : "Sin conexión";
  }
  window.addEventListener("online", setNet);
  window.addEventListener("offline", setNet);
  setNet();

  function safeGet(k){
    try{ return localStorage.getItem(k); }catch(_){ return null; }
  }

  // Ruta por defecto si no hay sesión
  let target = "login.html" + qs;

  try{
    const u = safeGet("auth_user");
    const r = safeGet("auth_role");
    if (u && r){
      target = "home.html" + qs; // Sesión válida → Home
      status.textContent = "Sesión detectada. Redirigiendo a Home…";
    }else{
      status.textContent = "Sin sesión. Redirigiendo a Login…";
    }
  }catch(err){
    console.error(err);
    status.textContent = "No se pudo leer la sesión. Irás a Login.";
  }

  // Intento de redirección inmediata
  try{
    // Pequeño timeout para que alcance a pintar el loader
    setTimeout(()=>{ location.replace(target); }, 80);
  }catch(_){
    // Fallback: mostrar botón para ir manualmente
    btnGo.style.display = "inline-block";
    btnGo.href = target;
  }

  // Hard reload (limpia cache)
  document.getElementById("hardReload").addEventListener("click", (e)=>{
    e.preventDefault();
    // Agrega un query anti-cache y recarga
    const u = new URL(location.href);
    u.searchParams.set("_", Date.now().toString());
    location.href = u.toString();
  });
})();
</script>
</body>
</html>
